--DROP TABLE dbo._skrbnik_tmp
CREATE TABLE dbo._skrbnik_tmp (
id_kupca char(6) not null,
id_skrbnik_1_new char(6) not null
)

INSERT INTO _skrbnik_tmp VALUES('000066','025205')
INSERT INTO _skrbnik_tmp VALUES('000273','011318')
INSERT INTO _skrbnik_tmp VALUES('001839','011071')
INSERT INTO _skrbnik_tmp VALUES('002532','005318')
INSERT INTO _skrbnik_tmp VALUES('003535','011080')
INSERT INTO _skrbnik_tmp VALUES('003536','011080')
INSERT INTO _skrbnik_tmp VALUES('003626','011313')
INSERT INTO _skrbnik_tmp VALUES('003981','017688')
INSERT INTO _skrbnik_tmp VALUES('004129','011318')
INSERT INTO _skrbnik_tmp VALUES('005866','011313')
INSERT INTO _skrbnik_tmp VALUES('006104','017688')
INSERT INTO _skrbnik_tmp VALUES('006557','011618')
INSERT INTO _skrbnik_tmp VALUES('008126','011318')
INSERT INTO _skrbnik_tmp VALUES('009998','011318')
INSERT INTO _skrbnik_tmp VALUES('010481','017688')
INSERT INTO _skrbnik_tmp VALUES('010860','011308')
INSERT INTO _skrbnik_tmp VALUES('010930','011318')
INSERT INTO _skrbnik_tmp VALUES('010957','011080')
INSERT INTO _skrbnik_tmp VALUES('011073','011318')
INSERT INTO _skrbnik_tmp VALUES('011077','011318')
INSERT INTO _skrbnik_tmp VALUES('011315','011318')
INSERT INTO _skrbnik_tmp VALUES('011779','011308')
INSERT INTO _skrbnik_tmp VALUES('011844','020822')
INSERT INTO _skrbnik_tmp VALUES('012139','011318')
INSERT INTO _skrbnik_tmp VALUES('012412','016693')
INSERT INTO _skrbnik_tmp VALUES('013187','011315')
INSERT INTO _skrbnik_tmp VALUES('013505','011318')
INSERT INTO _skrbnik_tmp VALUES('013715','011308')
INSERT INTO _skrbnik_tmp VALUES('014694','011318')
INSERT INTO _skrbnik_tmp VALUES('015221','020822')
INSERT INTO _skrbnik_tmp VALUES('015330','005318')
INSERT INTO _skrbnik_tmp VALUES('016690','011318')
INSERT INTO _skrbnik_tmp VALUES('017134','011318')
INSERT INTO _skrbnik_tmp VALUES('018115','011080')
INSERT INTO _skrbnik_tmp VALUES('018534','011318')
INSERT INTO _skrbnik_tmp VALUES('019423','010920')
INSERT INTO _skrbnik_tmp VALUES('019654','010920')
INSERT INTO _skrbnik_tmp VALUES('019676','011075')
INSERT INTO _skrbnik_tmp VALUES('019880','011071')
INSERT INTO _skrbnik_tmp VALUES('020616','011318')
INSERT INTO _skrbnik_tmp VALUES('021453','011308')
INSERT INTO _skrbnik_tmp VALUES('021637','011080')
INSERT INTO _skrbnik_tmp VALUES('024137','011618')
INSERT INTO _skrbnik_tmp VALUES('024661','014341')
INSERT INTO _skrbnik_tmp VALUES('026328','020253')
INSERT INTO _skrbnik_tmp VALUES('028114','011318')
INSERT INTO _skrbnik_tmp VALUES('028222','014341')
INSERT INTO _skrbnik_tmp VALUES('002010','020822')
INSERT INTO _skrbnik_tmp VALUES('002840','011075')
INSERT INTO _skrbnik_tmp VALUES('002869','011318')
INSERT INTO _skrbnik_tmp VALUES('003117','011075')
INSERT INTO _skrbnik_tmp VALUES('003188','011075')
INSERT INTO _skrbnik_tmp VALUES('003190','011075')
INSERT INTO _skrbnik_tmp VALUES('004208','011075')
INSERT INTO _skrbnik_tmp VALUES('004595','011075')
INSERT INTO _skrbnik_tmp VALUES('006815','011075')
INSERT INTO _skrbnik_tmp VALUES('008305','011075')
INSERT INTO _skrbnik_tmp VALUES('008357','011075')
INSERT INTO _skrbnik_tmp VALUES('008894','025205')
INSERT INTO _skrbnik_tmp VALUES('009019','011075')
INSERT INTO _skrbnik_tmp VALUES('009329','025205')
INSERT INTO _skrbnik_tmp VALUES('009912','011075')
INSERT INTO _skrbnik_tmp VALUES('011075','011075')
INSERT INTO _skrbnik_tmp VALUES('011237','011318')
INSERT INTO _skrbnik_tmp VALUES('011552','011075')
INSERT INTO _skrbnik_tmp VALUES('012482','011075')
INSERT INTO _skrbnik_tmp VALUES('012855','025205')
INSERT INTO _skrbnik_tmp VALUES('012897','025205')
INSERT INTO _skrbnik_tmp VALUES('013729','025205')
INSERT INTO _skrbnik_tmp VALUES('014085','011075')
INSERT INTO _skrbnik_tmp VALUES('015185','025205')
INSERT INTO _skrbnik_tmp VALUES('015338','011318')
INSERT INTO _skrbnik_tmp VALUES('015755','025205')
INSERT INTO _skrbnik_tmp VALUES('015866','025205')
INSERT INTO _skrbnik_tmp VALUES('015889','011075')
INSERT INTO _skrbnik_tmp VALUES('016117','025205')
INSERT INTO _skrbnik_tmp VALUES('016118','025205')
INSERT INTO _skrbnik_tmp VALUES('016176','011075')
INSERT INTO _skrbnik_tmp VALUES('016192','025205')
INSERT INTO _skrbnik_tmp VALUES('016296','011075')
INSERT INTO _skrbnik_tmp VALUES('016301','025205')
INSERT INTO _skrbnik_tmp VALUES('016308','025205')
INSERT INTO _skrbnik_tmp VALUES('016471','025205')
INSERT INTO _skrbnik_tmp VALUES('016790','025205')
INSERT INTO _skrbnik_tmp VALUES('017384','025205')
INSERT INTO _skrbnik_tmp VALUES('018387','011075')
INSERT INTO _skrbnik_tmp VALUES('018703','025205')
INSERT INTO _skrbnik_tmp VALUES('018736','025205')
INSERT INTO _skrbnik_tmp VALUES('018805','025205')
INSERT INTO _skrbnik_tmp VALUES('019117','025205')
INSERT INTO _skrbnik_tmp VALUES('019224','025205')
INSERT INTO _skrbnik_tmp VALUES('019458','025205')
INSERT INTO _skrbnik_tmp VALUES('020760','011075')
INSERT INTO _skrbnik_tmp VALUES('020892','025205')
INSERT INTO _skrbnik_tmp VALUES('021024','025205')
INSERT INTO _skrbnik_tmp VALUES('021064','016693')
INSERT INTO _skrbnik_tmp VALUES('021383','025205')
INSERT INTO _skrbnik_tmp VALUES('021404','025205')
INSERT INTO _skrbnik_tmp VALUES('021448','011075')
INSERT INTO _skrbnik_tmp VALUES('021504','025205')
INSERT INTO _skrbnik_tmp VALUES('021816','011075')
INSERT INTO _skrbnik_tmp VALUES('021823','011075')
INSERT INTO _skrbnik_tmp VALUES('021931','025205')
INSERT INTO _skrbnik_tmp VALUES('021933','017688')
INSERT INTO _skrbnik_tmp VALUES('022128','011075')
INSERT INTO _skrbnik_tmp VALUES('022249','020822')
INSERT INTO _skrbnik_tmp VALUES('022544','025205')
INSERT INTO _skrbnik_tmp VALUES('022898','011075')
INSERT INTO _skrbnik_tmp VALUES('023205','011075')
INSERT INTO _skrbnik_tmp VALUES('023583','011075')
INSERT INTO _skrbnik_tmp VALUES('023609','011075')
INSERT INTO _skrbnik_tmp VALUES('023697','011075')
INSERT INTO _skrbnik_tmp VALUES('024173','011318')
INSERT INTO _skrbnik_tmp VALUES('024190','011075')
INSERT INTO _skrbnik_tmp VALUES('024204','016693')
INSERT INTO _skrbnik_tmp VALUES('024212','011071')
INSERT INTO _skrbnik_tmp VALUES('024304','020253')
INSERT INTO _skrbnik_tmp VALUES('024383','011075')
INSERT INTO _skrbnik_tmp VALUES('024401','011071')
INSERT INTO _skrbnik_tmp VALUES('024507','011318')
INSERT INTO _skrbnik_tmp VALUES('024743','011071')
INSERT INTO _skrbnik_tmp VALUES('024912','011075')
INSERT INTO _skrbnik_tmp VALUES('024937','011075')
INSERT INTO _skrbnik_tmp VALUES('025220','011075')
INSERT INTO _skrbnik_tmp VALUES('025222','011075')
INSERT INTO _skrbnik_tmp VALUES('025383','011075')
INSERT INTO _skrbnik_tmp VALUES('025679','011075')
INSERT INTO _skrbnik_tmp VALUES('025710','011075')
INSERT INTO _skrbnik_tmp VALUES('025963','011075')
INSERT INTO _skrbnik_tmp VALUES('026212','011318')
INSERT INTO _skrbnik_tmp VALUES('026259','011075')
INSERT INTO _skrbnik_tmp VALUES('026372','011071')
INSERT INTO _skrbnik_tmp VALUES('026409','020253')
INSERT INTO _skrbnik_tmp VALUES('026641','011071')
INSERT INTO _skrbnik_tmp VALUES('026674','011075')
INSERT INTO _skrbnik_tmp VALUES('026944','011075')
INSERT INTO _skrbnik_tmp VALUES('026960','011075')
INSERT INTO _skrbnik_tmp VALUES('026968','011075')
INSERT INTO _skrbnik_tmp VALUES('026979','011075')
INSERT INTO _skrbnik_tmp VALUES('027040','011075')
INSERT INTO _skrbnik_tmp VALUES('027116','011318')
INSERT INTO _skrbnik_tmp VALUES('027177','011075')
INSERT INTO _skrbnik_tmp VALUES('027228','011075')
INSERT INTO _skrbnik_tmp VALUES('027470','011075')
INSERT INTO _skrbnik_tmp VALUES('027529','011075')
INSERT INTO _skrbnik_tmp VALUES('027612','011075')
INSERT INTO _skrbnik_tmp VALUES('027656','011318')
INSERT INTO _skrbnik_tmp VALUES('027711','016693')
INSERT INTO _skrbnik_tmp VALUES('027779','011313')
INSERT INTO _skrbnik_tmp VALUES('027820','011075')
INSERT INTO _skrbnik_tmp VALUES('000221','020843')
INSERT INTO _skrbnik_tmp VALUES('000337','022810')
INSERT INTO _skrbnik_tmp VALUES('015575','022810')
INSERT INTO _skrbnik_tmp VALUES('005651','020843')
INSERT INTO _skrbnik_tmp VALUES('010321','022810')
INSERT INTO _skrbnik_tmp VALUES('011323','020843')
INSERT INTO _skrbnik_tmp VALUES('011812','022810')
INSERT INTO _skrbnik_tmp VALUES('012202','020843')
INSERT INTO _skrbnik_tmp VALUES('012407','022810')
INSERT INTO _skrbnik_tmp VALUES('012802','022810')
INSERT INTO _skrbnik_tmp VALUES('014463','020843')
INSERT INTO _skrbnik_tmp VALUES('015077','020843')
INSERT INTO _skrbnik_tmp VALUES('015272','020843')
INSERT INTO _skrbnik_tmp VALUES('015471','020843')
INSERT INTO _skrbnik_tmp VALUES('016390','020843')
INSERT INTO _skrbnik_tmp VALUES('016527','020843')
INSERT INTO _skrbnik_tmp VALUES('018143','022810')
INSERT INTO _skrbnik_tmp VALUES('018242','022810')
INSERT INTO _skrbnik_tmp VALUES('019086','020843')
INSERT INTO _skrbnik_tmp VALUES('019863','020843')
INSERT INTO _skrbnik_tmp VALUES('021280','020843')
INSERT INTO _skrbnik_tmp VALUES('021651','020843')
INSERT INTO _skrbnik_tmp VALUES('019722','020843')
INSERT INTO _skrbnik_tmp VALUES('024789','020843')

select * from _skrbnik_tmp

--PROMJENA SAMO ZA RAZLIČITE SKRBNIKE
Select a.id_kupca, a.skrbnik_1, b.id_skrbnik_1_new, a.naz_kr_kup from nova_prod.dbo.partner a
join _skrbnik_tmp b on a.id_kupca=b.id_kupca and isnull(a.skrbnik_1,'') != b.id_skrbnik_1_new
order by a.id_kupca
/*
Select a.id_kupca, a.skrbnik_1, b.id_skrbnik_1_new, a.naz_kr_kup from partner a
join _skrbnik_tmp b on a.id_kupca=b.id_kupca
order by a.id_kupca */
********************************************
&&ovo puštaš u dio Execute fox script
#INCLUDE locs.h
LOCAL lcXML, lcXmlDiff, lcSQLString, lnErrorCount, lnUkupno, lcOpomba, lcPoruka
lcPoruka = 'Nijedan podatak nije promijenjen za partner/e:'
lcOpomba = "Ažuriranje podatka Skrbnik 1 partnera prema zahtjevu 1179 (MID 27222)"
select rezultat

lnUkupno=RECCOUNT()
lnErrorCount=0
go top
scan
      TEXT TO lcSQLString NOSHOW
		SELECT ban_tr1, ban_tr2, ban_zr, boniteta, clan_eu, cona, d_os_izk, dat_opomin,
		       dat_roj, dat_vnosa, dav_obv, dav_stev, delodajale, direktor, dobavite, email,
		       emso, emso_kon, ext_id, fax, http, id, id_kupca, id_poste, id_poste_k, id_poste_sed,
		       id_skis, kontakt, kr_os_izk, kraj_roj, kupci, mesto, mesto_sed, naz_kr_kup,
		       naziv1_kup, naziv2_kup, opombe, polni_naz, posrednik, sif_dej, st_os_izk,
		       cast(sys_ts as bigint) as sys_ts, tel_dir, telefon, telefon_k, tr1, tr2, ulica,
		       ulica_k, ulica_sed, vnesel, vr_osebe, zr1, zr2, zr3, p_kateg, p_oblika, priimek,
		       ime, stev_reg, dat_reg, sod_reg, drzavljan, dat_poprave,ulica_d, id_poste_d, mesto_d, p_status, kontakt_d,
		       tip_os_izk, zac_pos, spol, zak_stan, st_otrok, poklic, izobrazba, vrst_preb, akad_naziv, asset_clas,
		       ustanovit, opis_dej, dob_kup, del_mesto, zap_od, zap_do, tip_zap, gsm, telefon_s, skrbnik_1, skrbnik_2,
		       d_vrednot, ne_na_bl, watch_from, neaktiven, kategorija1, kategorija2, kategorija3, tuja_pio, ident_stevilka
		  FROM dbo.partner
	ENDTEXT
	lcSQLString = lcSQLString + " WHERE id_kupca= "+GF_QuotedStr(allt(rezultat.id_kupca))
	GF_SQLEXEC(lcSQLString, 'partner')

        SELECT * FROM partner INTO CURSOR _partner_copy

REPLACE skrbnik_1 WITH rezultat.id_skrbnik_1_new in partner
REPLACE id WITH 'g_system' IN partner
        
	lcXML = "<?xml version='1.0' encoding='utf-8' ?>" + gcE
    lcXML = lcXML + '<rpg_partner_update xmlns="urn:gmi:nova:leasing">'
    lcXmlDiff = GF_CreateUpdateDifFieldsXML('PARTNER', "partner", "_partner_copy")

&& izbaciti ako možda ima puno zapisa na kojima nema promjene
	IF EMPTY(lcXmlDiff) THEN
		lcPoruka = lcPoruka+gcE+allt(rezultat.naz_kr_kup)
		*pozor("Nijedan podatak nije promijenjen.")
	ENDIF
		
    lcXmlDiff = lcXmlDiff + '<updated_values>' + gcE
	lcXmlDiff = lcXmlDiff + GF_CreateNode("table_name", "partner", "C", 1)+ gcE
	lcXmlDiff = lcXmlDiff + GF_CreateNode("name", "dat_poprave", "C", 1)+ gcE
	lcXmlDiff = lcXmlDiff + GF_CreateNode("updated_value", DATETIME(), "T", 1)+ gcE
	lcXmlDiff = lcXmlDiff + '</updated_values>'

	lcXML = "<?xml version='1.0' encoding='utf-8' ?>"
	lcXML = lcXML + '<rpg_partner_update xmlns="urn:gmi:nova:leasing">' + gcE
	lcXML = lcXML + '<common_parameters>'+ gcE
	lcXML = lcXML + GF_CreateNode("id_kupca", partner.id_kupca, "C", 1)+ gcE
	lcXML = lcXML + GF_CreateNode("comment", lcOpomba, "C", 1)+ gcE
	lcXML = lcXML + GF_CreateNode("sys_ts", partner.sys_ts, "I", 1) + gcE
	lcXML = lcXML + '</common_parameters>'+ gcE

	lcXML = lcXML + lcXmlDiff
	lcXML = lcXML + "</rpg_partner_update>"

        IF !GF_ProcessXml(lcXML) THEN
	   lnErrorCount=lnErrorCount+1
	ENDIF
endscan
=obvesti("Ukupno: "+allt(trans(lnUkupno))+". Greške: "+allt(trans(lnErrorCount)))
_cliptext = lcPoruka
obvesti (lcPoruka+gcE+'Podaci su kopirani u clipboard!!!')
**************************
select * from reprogram where time>=getdate()-1 and [user] = 'g_tomislav'
UPDATE reprogram SET [user] = 'g_system' where time>=getdate()-1 and [user] = 'g_tomislav'